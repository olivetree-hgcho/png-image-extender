---
name: 다중 바이너리 프로젝트 구조
overview: 핵심 이미지 처리 로직을 라이브러리로 분리하고, CLI와 MCP 서버를 각각 독립 바이너리로 빌드할 수 있도록 프로젝트를 재구성합니다.
todos:
  - id: create-lib
    content: src/lib.rs 생성 - process_image, find_png_files 핵심 로직 추출
    status: completed
  - id: create-cli-bin
    content: src/bin/cli.rs 생성 - CLI main 함수 및 Args 구조체 이동
    status: completed
    dependencies:
      - create-lib
  - id: create-mcp-bin
    content: src/bin/mcp_server.rs 생성 - MCP 서버가 lib.rs 함수 호출하도록 수정
    status: completed
    dependencies:
      - create-lib
  - id: update-cargo
    content: Cargo.toml에 [lib] 및 [[bin]] 섹션 추가
    status: completed
  - id: cleanup
    content: 기존 main.rs, mcp_boilerplate.rs 삭제
    status: completed
    dependencies:
      - create-cli-bin
      - create-mcp-bin
---

# 다중 바이너리 프로젝트 구조 설계

## 추천 구조

```javascript
src/
├── lib.rs           # 핵심 이미지 처리 로직 (라이브러리)
├── bin/
│   ├── cli.rs       # CLI 바이너리 (현재 main.rs 내용)
│   └── mcp_server.rs # MCP 서버 바이너리 (현재 mcp_boilerplate.rs 내용)
```



## 아키텍처 다이어그램

```mermaid
graph TB
    subgraph lib [lib.rs - 공통 라이브러리]
        ProcessImage[process_image 함수]
        FindPngFiles[find_png_files 함수]
    end
    
    subgraph binaries [바이너리들]
        CLI[cli.rs<br/>독립 실행 CLI]
        MCP[mcp_server.rs<br/>MCP 서버]
    end
    
    CLI --> ProcessImage
    CLI --> FindPngFiles
    MCP --> ProcessImage
```



## Cargo.toml 변경

```toml
[package]
name = "image_extender"
version = "0.1.0"
edition = "2021"

[lib]
name = "image_extender"
path = "src/lib.rs"

[[bin]]
name = "image_extender"
path = "src/bin/cli.rs"

[[bin]]
name = "image_extender_mcp"
path = "src/bin/mcp_server.rs"

[dependencies]
# ... 기존 의존성 유지
```



## 파일별 역할

| 파일 | 역할 ||------|------|| [src/lib.rs](src/lib.rs) | `process_image()`, `find_png_files()` 등 핵심 로직 || [src/bin/cli.rs](src/bin/cli.rs) | CLI 인터페이스 (clap 파싱, main 함수) || [src/bin/mcp_server.rs](src/bin/mcp_server.rs) | MCP JSON-RPC 서버 |

## 빌드 및 실행 방법

```bash
# 모든 바이너리 빌드
cargo build --release

# CLI만 실행
cargo run --bin image_extender -- ./res 512 512

# MCP 서버만 실행
cargo run --bin image_extender_mcp
```



## 구현 단계

1. `src/lib.rs` 생성 - [main.rs](src/main.rs)에서 `process_image`, `find_png_files` 함수 추출
2. `src/bin/` 디렉토리 생성
3. `src/bin/cli.rs` 생성 - CLI main 함수와 clap Args 이동
4. `src/bin/mcp_server.rs` 생성 - [mcp_boilerplate.rs](src/mcp_boilerplate.rs)를 기반으로 lib.rs의 함수 호출하도록 수정
5. `Cargo.toml` 업데이트 - lib 및 bin 섹션 추가
6. 기존 `src/main.rs`, `src/mcp_boilerplate.rs` 삭제

## 장점